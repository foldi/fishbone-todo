/*! ToDo v1.1.0 - 2013-09-19 04:09:34 
Vince Allen |Brooklyn, NY | vince@vinceallen.com | @vinceallenvince | License: MIT */
!function(a,b){b.ToDo=a;var c=Model({init:function(a,b){this.el=document.createElement("div"),this.el.id=a,this.el.className="view",this.template=doT.template(b)},render:function(a){this.el.innerHTML=this.template(a)},remove:function(){this.el.parentNode&&this.el.parentNode.removeChild(this.el)}}),d=Model({init:function(a,b,c){this.app=a,this.el=b,this.events=c||[]},addEvents:function(a){for(var b in this.events)this.events.hasOwnProperty(b)&&a.el.addEventListener(b,this[this.events[b]])},removeEvents:function(a){for(var b in this.events)this.events.hasOwnProperty(b)&&a.el.removeEventListener(b,this[this.events[b]])},create:function(){throw new Error("create() is not implemented.")},render:function(a,b){a.view=new c(a.id,b),a.view.render(a),this.addEvents(a.view),a.view.el.innerHTML=a.view.template(a),this.el.appendChild(a.view.el)},updateView:function(a){a.view.render(a)},removeView:function(a){this.removeEvents(a.view),a.view.remove()},updateItem:function(a,b,c){this.app.records.lookup[a].update(b,c),this.trigger("updateItem")},removeItem:function(a){this.app.records.lookup[a].remove(this.app.records),this.trigger("removeItem")},getItemIdByDOMNode:function(a){var b=null,c=a;if(c.id)return c.id;for(;!b;)c.parentNode.id||c.parentNode===document.body?b=c.parentNode.id:c=c.parentNode;return b},getItemById:function(a){return this.app.records.lookup[a]},getItemsByAttribute:function(a,b){var c,d,e,f=this.app.records,g=[];for(c=0,d=f.list.length;d>c;c++)e=f.list[c],e[a]===b&&g.push(e);return g}}),e={task:'<table class="item"><tr><td class="detail left"><a class="action" rel="done">done</a></td><td class="detail middle {{? it.done}}done{{?}}">{{=it.name}}</td><td class="detail right"><a class="action" rel="remove">del</a></td></tr></table>',menuItem:'<a id="{{=it.id}}" class="menuItem {{? it.selected}}selected{{?}}" rel="{{=it.type}}" href="#">{{=it.name}}</a>',totalTasks:"<span>{{? it.total}}{{=it.total}} {{? it.total === 1}}item {{?? }}items {{?}} left{{?}}</span>",clearCompleted:'{{? it.total}}<a class="clearCompletedItem">clear done ({{=it.total}})</a>{{?}}'},f=Model({records:{list:[],lookup:{}},idCount:0,init:function(a,b,c){var d,f,g;this.router=a,this.doT=b,this.form=c,this.form.addEventListener("submit",this.formSubmit),this.totalTasksController=new n(this,document.getElementById("totalTasks"));var i=this.totalTasksController.create({total:this.totalTasksController.getTotalTasks()});this.totalTasksController.render(i,e.totalTasks),this.clearCompletedController=new h(this,document.getElementById("clearCompleted"),{click:"click"});var k=this.clearCompletedController.create({total:this.clearCompletedController.getTotalCompleted()});this.clearCompletedController.render(k,e.clearCompleted),this.clearCompletedController.on("removeItem",this.totalTasksController.updateTotal.bind(this.totalTasksController,i)),this.taskController=new l(this,document.getElementById("tasks"),{click:"click"}),this.taskController.on("createItem",this.totalTasksController.updateTotal.bind(this.totalTasksController,i)),this.taskController.on("updateItem",this.clearCompletedController.updateTotal.bind(this.clearCompletedController,k)),this.taskController.on("removeItem",this.totalTasksController.updateTotal.bind(this.totalTasksController,i)),this.menuItemController=new j(this,document.getElementById("menuItems"),{click:"click"});var m=this.menuItemController.create({name:"all",type:"all",selected:!0});this.menuItemController.render(m,e.menuItem);var o=this.menuItemController.create({name:"active",type:"active"});this.menuItemController.render(o,e.menuItem);var p=this.menuItemController.create({name:"complete",type:"complete"});if(this.menuItemController.render(p,e.menuItem),this.router.add([{path:"#/show/:type",handler:this.taskController.refresh}]),g=this.router.recognize(window.location.hash))for(d=0,f=g.length;f>d;d++)g[d].handler.call(this,g[d].params.type)},formSubmit:function(a){a.preventDefault();var b=a.target.querySelector("input");if(b.value){var c=this.taskController.create({name:b.value});this.taskController.render(c,e.task),b.value=""}}}),g=Model({init:function(a,b){this.id=a,this.total=b.total,this.trigger("create")},update:function(a,b){this[a]=b,this.trigger("update",this)}}),h=d.extend({create:function(a){var b=new g(++this.app.idCount,a);return b.on("update",this.updateView),b.on("remove",this.removeView),this.app.records.list.push(b),this.app.records.lookup[b.id]=b,this.trigger("createItem"),b},getTotalCompleted:function(){var a,b,c=this.app.records,d=0;for(a=c.list.length-1;a>=0;a--)b=c.list[a],b instanceof k&&b.done&&d++;return d},updateTotal:function(a){this.updateItem(a.id,"total",this.getTotalCompleted())},click:function(){var a,b,c,d=this.app.records;for(a=d.list.length-1;a>=0;a--)b=d.list[a],b instanceof k&&b.done?this.removeItem(b.id):b instanceof g&&(c=b);this.updateTotal(c),this.trigger("removeItem")}}),i=Model({init:function(a,b){this.id=a,this.name=b.name,this.type=b.type,this.selected=!!b.selected,this.trigger("create")},update:function(a,b){this[a]=b,this.trigger("update",this)}}),j=d.extend({create:function(a){var b=new i(++this.app.idCount,a);return b.on("update",this.updateView),b.on("remove",this.removeView),this.app.records.list.push(b),this.app.records.lookup[b.id]=b,this.trigger("createItem"),b},click:function(a){var b,c,d,e=this.app.records,f=this.getItemIdByDOMNode(a.target);for(a.target.getAttribute("rel"),b=e.list.length-1;b>=0;b--)d=e.list[b],d instanceof i&&this.updateItem(d.id,"selected",!1);this.updateItem(f,"selected",!0),a.preventDefault();var g,h="#/show/"+a.target.rel;for(window.history.pushState(a.target.rel,"ToDo",h),g=this.app.router.recognize(h),b=0,c=g.length;c>b;b++)g[b].handler.call(this,g[b].params.type)}}),k=Model({init:function(a,b){this.id=a,this.name=b.name,this.done=!1},update:function(a,b){this[a]=b,this.trigger("update",this)},remove:function(a){for(var b=0,c=a.list.length;c>b;b++)if(this===a.list[b]){a.list.splice(b,1);break}delete a.lookup[this.id],this.trigger("remove",this),this.off("update",this.updateView),this.off("remove",this.removeView)}}),l=d.extend({create:function(a){var b=new k(++this.app.idCount,a);return b.on("update",this.updateView),b.on("remove",this.removeView),this.app.records.list.push(b),this.app.records.lookup[b.id]=b,this.trigger("createItem"),b},click:function(a){var b=this.getItemIdByDOMNode(a.target),c=a.target.getAttribute("rel");"done"===c?this.updateItem(b,"done",!this.getItemById(b).done):"remove"===c&&this.removeItem(b)},refresh:function(a){var b,c,d,f,g,h=this.app.records;for(b=h.list.length-1;b>=0;b--)d=h.list[b],d instanceof k&&d.view.remove();for(g="all"===a?h.list:"active"===a?this.getItemsByAttribute("done",!1):this.getItemsByAttribute("done",!0),b=0,c=g.length;c>b;b++)f=g[b],f instanceof k&&this.render(f,e.task)}}),m=Model({init:function(a,b){this.id=a,this.total=b.total,this.trigger("create")},update:function(a,b){this[a]=b,this.trigger("update",this)}}),n=d.extend({create:function(a){var b=new m(++this.app.idCount,a);return b.on("update",this.updateView),b.on("remove",this.removeView),this.app.records.list.push(b),this.app.records.lookup[b.id]=b,this.trigger("createItem"),b},getTotalTasks:function(){var a,b,c=this.app.records,d=0;for(a=c.list.length-1;a>=0;a--)b=c.list[a],b instanceof k&&d++;return d},updateTotal:function(a){this.updateItem(a.id,"total",this.getTotalTasks())}});a.View=c,a.Controller=d,a.Templates=e,a.App=f,a.ClearCompleted=g,a.ClearCompletedController=h,a.MenuItem=i,a.MenuItemController=j,a.Task=k,a.TaskController=l,a.TotalTasks=m,a.TotalTasksController=n}({},function(){return this}());