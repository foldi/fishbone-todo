(function(F){function A(a){this.string=a}function B(a){this.name=a}function C(a){this.name=a}function w(){}function t(a){this.charSpec=a;this.nextStates=[]}function G(a){return a.sort(function(a,b){return a.types.stars!==b.types.stars?a.types.stars-b.types.stars:a.types.dynamics!==b.types.dynamics?a.types.dynamics-b.types.dynamics:a.types.statics!==b.types.statics?a.types.statics-b.types.statics:0})}function H(a,c){c.eachChar(function(b){a=a.put(b)});return a}function D(a,c,b){this.path=a;this.matcher=
c;this.delegate=b}function v(a){this.routes={};this.children={};this.queryParams={};this.target=a}function y(a,c,b){return function(d,e){var f=a+d;if(e)e(y(f,c,b));else return new D(a+d,c,b)}}function E(a,c,b,d){var e=c.routes,f=c.queryParams,g;for(g in e)if(e.hasOwnProperty(g)){for(var h=a.slice(),p=h,m=g,r=e[g],q=f[g],k=0,l=0,n=p.length;l<n;l++)k+=p[l].path.length;m=m.substr(k);m={path:m,handler:r};q&&(m.queryParams=q);p.push(m);c.children[g]?E(h,c.children[g],b,d):b.call(d,h)}}var I=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)",
"g");A.prototype={eachChar:function(a){for(var c=this.string,b,d=0,e=c.length;d<e;d++)b=c.charAt(d),a({validChars:b})},regex:function(){return this.string.replace(I,"\\$1")},generate:function(){return this.string}};B.prototype={eachChar:function(a){a({invalidChars:"/",repeat:!0})},regex:function(){return"([^/]+)"},generate:function(a){return a[this.name]}};C.prototype={eachChar:function(a){a({invalidChars:"",repeat:!0})},regex:function(){return"(.+)"},generate:function(a){return a[this.name]}};w.prototype=
{eachChar:function(){},regex:function(){return""},generate:function(){return""}};t.prototype={get:function(a){for(var c=this.nextStates,b=0,d=c.length;b<d;b++){var e=c[b],f=e.charSpec.validChars===a.validChars;if(f=f&&e.charSpec.invalidChars===a.invalidChars)return e}},put:function(a){var c;if(c=this.get(a))return c;c=new t(a);this.nextStates.push(c);a.repeat&&c.nextStates.push(c);return c},match:function(a){for(var c=this.nextStates,b,d,e,f=[],g=0,h=c.length;g<h;g++)b=c[g],d=b.charSpec,"undefined"!==
typeof(e=d.validChars)?-1!==e.indexOf(a)&&f.push(b):"undefined"!==typeof(e=d.invalidChars)&&-1===e.indexOf(a)&&f.push(b);return f}};var z=function(){this.rootState=new t;this.names={}};z.prototype={add:function(a,c){for(var b=this.rootState,d="^",e={statics:0,dynamics:0,stars:0},f=[],g=[],h=!0,p=0,m=a.length;p<m;p++){var r=a[p],q=[],k,l=r.path;k=q;var n=e;"/"===l.charAt(0)&&(l=l.substr(1));for(var l=l.split("/"),s=[],t=0,v=l.length;t<v;t++){var x=l[t],u;(u=x.match(/^:([^\/]+)$/))?(s.push(new B(u[1])),
k.push(u[1]),n.dynamics++):(u=x.match(/^\*([^\/]+)$/))?(s.push(new C(u[1])),k.push(u[1]),n.stars++):""===x?s.push(new w):(s.push(new A(x)),n.statics++)}k=s;g=g.concat(k);n=0;for(l=k.length;n<l;n++)s=k[n],s instanceof w||(h=!1,b=b.put({validChars:"/"}),d+="/",b=H(b,s),d+=s.regex());q={handler:r.handler,names:q};r.queryParams&&(q.queryParams=r.queryParams);f.push(q)}h&&(b=b.put({validChars:"/"}),d+="/");b.handlers=f;b.regex=RegExp(d+"$");b.types=e;if(b=c&&c.as)this.names[b]={segments:g,handlers:f}},
handlersFor:function(a){var c=this.names[a],b=[];if(!c)throw Error("There is no route named "+a);a=0;for(var d=c.handlers.length;a<d;a++)b.push(c.handlers[a]);return b},hasRoute:function(a){return!!this.names[a]},generate:function(a,c){var b=this.names[a],d="";if(!b)throw Error("There is no route named "+a);for(var e=b.segments,f=0,g=e.length;f<g;f++){var h=e[f];h instanceof w||(d+="/",d+=h.generate(c))}"/"!==d.charAt(0)&&(d="/"+d);c&&c.queryParams&&(d+=this.generateQueryString(c.queryParams,b.handlers));
return d},generateQueryString:function(a,c){for(var b=[],d=[],e=0;e<c.length;e++){var f=c[e].queryParams;f&&d.push.apply(d,f)}for(var g in a)if(a.hasOwnProperty(g)){if(!~d.indexOf(g))throw'Query param "'+g+'" is not specified as a valid param for this route';e=a[g];f=encodeURIComponent(g);!0!==e&&(f+="="+encodeURIComponent(e));b.push(f)}return 0===b.length?"":"?"+b.join("&")},parseQueryString:function(a){a=a.split("&");for(var c={},b=0;b<a.length;b++){var d=a[b].split("="),e=decodeURIComponent(d[0]),
d=d[1]?decodeURIComponent(d[1]):!0;c[e]=d}return c},recognize:function(a){var c=[this.rootState],b,d,e={};b=a.indexOf("?");~b&&(e=a.substr(b+1,a.length),a=a.substr(0,b),e=this.parseQueryString(e));"/"!==a.charAt(0)&&(a="/"+a);b=a.length;1<b&&"/"===a.charAt(b-1)&&(a=a.substr(0,b-1));b=0;for(d=a.length;b<d;b++){for(var f=a.charAt(b),g=[],h=0,p=c.length;h<p;h++)g=g.concat(c[h].match(f));c=g;if(!c.length)break}f=[];b=0;for(d=c.length;b<d;b++)c[b].handlers&&f.push(c[b]);G(f);if((d=f[0])&&d.handlers){b=
d.handlers;a=a.match(d.regex);d=1;c=[];f=0;for(g=b.length;f<g;f++){var m=b[f],r=m.names,q={},h=m.queryParams||[],p={},k,l;k=0;for(l=r.length;k<l;k++)q[r[k]]=a[d++];k=0;for(l=h.length;k<l;k++){var n=h[k];e[n]&&(p[n]=e[n])}m={handler:m.handler,params:q,isDynamic:!!r.length};h&&0<h.length&&(m.queryParams=p);c.push(m)}return c}}};D.prototype={to:function(a,c){var b=this.delegate;b&&b.willAddRoute&&(a=b.willAddRoute(this.matcher.target,a));this.matcher.add(this.path,a);if(c){if(0===c.length)throw Error("You must have an argument in the function passed to `to`");
this.matcher.addChild(this.path,a,c,this.delegate)}return this},withQueryParams:function(){if(0===arguments.length)throw Error("you must provide arguments to the withQueryParams method");for(var a=0;a<arguments.length;a++)if("string"!==typeof arguments[a])throw Error('you should call withQueryParams with a list of strings, e.g. withQueryParams("foo", "bar")');a=[].slice.call(arguments);this.matcher.addQueryParams(this.path,a)}};v.prototype={add:function(a,c){this.routes[a]=c},addQueryParams:function(a,
c){this.queryParams[a]=c},addChild:function(a,c,b,d){var e=new v(c);this.children[a]=e;a=y(a,e,d);d&&d.contextEntered&&d.contextEntered(c,a);b(a)}};z.prototype.map=function(a,c){var b=new v;a(y("",b,this.delegate));E([],b,function(a){c?c(this,a):this.add(a)},this)};F.RouteRecognizer=z})(window);