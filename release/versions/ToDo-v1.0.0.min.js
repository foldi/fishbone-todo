/*! ToDo v1.0.0 - 2013-09-18 01:09:56 
Vince Allen |Brooklyn, NY | vince@vinceallen.com | @vinceallenvince | License: MIT */
!function(a,b){b.ToDo=a;var c=Model({init:function(a,b){this.id=a,this.name=b,this.done=!1},update:function(a,b){this[a]=b,this.trigger("update",this)},"delete":function(){this.trigger("delete",this)}}),d=Model({init:function(a,b){this.el=document.createElement("div"),this.el.id=a,this.el.className="view",this.template=doT.template(b)},render:function(a){this.el.innerHTML=this.template(a)},remove:function(){this.el.parentNode&&this.el.parentNode.removeChild(this.el)}}),e=Model({records:{list:[],lookup:{}},idCount:0,init:function(a,b,c,e,g){var h,i,j,k;for(this.router=a,this.doT=b,this.form=c,this.form.addEventListener("submit",this.formSubmit),this.results=e,this.menu=g,this.totalView=new d("totalView",f.total),this.totalView.render({total:this.records.list.length}),this.menu.querySelector(".left").appendChild(this.totalView.el),this.results.addEventListener("click",this.handleItemClick),k=document.querySelectorAll(".menuLink"),h=0,i=k.length;i>h;h++)k[h].addEventListener("click",this.filter);for(this.router.add([{path:"#show/:type",handler:this.refresh}]),j=this.router.recognize(window.location.hash),h=0,i=j.length;i>h;h++)j[h].handler.call(this,j[h].params.type)},formSubmit:function(a){a.preventDefault();var b=a.target.querySelector("input");b.value&&(this.createItem(b.value),b.value="")},createItem:function(a){this.idCount++;var b=new c(this.idCount,a);this.records.list.push(b),this.records.lookup[this.idCount]=b,this.renderItem(b),this.totalView.render({total:this.records.list.length})},updateItem:function(a,b,c){this.records.lookup[a].update(b,c)},deleteItem:function(a){var b,c,d;for(this.records.lookup[a].delete(a),b=0,c=this.records.list.length;c>b;b++)if(d=this.records.list[b],d.id===parseInt(a,10)){d.off("update",d.view.render.bind(d.view,d)),d.off("delete",d.view.remove.bind(d.view)),this.records.list.splice(b,1),delete this.records.lookup[a];break}this.totalView.render({total:this.records.list.length})},renderItem:function(a){a.view=new d(a.id,f.item),a.view.render({name:a.name}),this.results.appendChild(a.view.el),a.on("update",a.view.render.bind(a.view,a)),a.on("delete",a.view.remove.bind(a.view))},handleItemClick:function(a){var b=a.target.parentNode.parentNode.parentNode.parentNode.id,c=a.target.getAttribute("rel");"done"===c?this.updateItem(b,"done",!this.getItemById(b).done):"delete"===c&&this.deleteItem(b)},filter:function(a){a.preventDefault();var b,c,d,e="#show/"+a.target.rel;for(window.history.pushState(a.target.rel,"Title",e),d=this.router.recognize(e),b=0,c=d.length;c>b;b++)d[b].handler.call(this,d[b].params.type)},refresh:function(a){var b,c,d;for(b=this.records.list.length-1;b>=0;b--)this.records.list[b].view.remove();for(d="all"===a?this.records.list:"active"===a?this.getItemsByAttribute("done",!1):this.getItemsByAttribute("done",!0),b=0,c=d.length;c>b;b++)this.renderItem(d[b])},getItemById:function(a){return this.records.lookup[a]},getItemsByAttribute:function(a,b){var c,d,e,f=[];for(c=0,d=this.records.list.length;d>c;c++)e=this.records.list[c],e[a]===b&&f.push(e);return f}}),f={total:'<div id="totalView" class="view">{{? it.total}}{{=it.total}} {{? it.total === 1}}item {{?? }}items {{?}} left{{?}}</div>',item:'<table class="item"><tr><td class="detail left" rel="done">done</td><td class="detail middle {{? it.done}}done{{?}}">{{=it.name}}</td><td class="detail right" rel="delete">del</td></tr></table>'};a.Item=c,a.View=d,a.App=e,a.Templates=f}({},function(){return this}());